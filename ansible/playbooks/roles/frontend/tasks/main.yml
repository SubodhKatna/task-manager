- name: Ensure frontend directory exists
  file:
    path: /opt/task-manager/frontend
    state: directory
    owner: ec2-user
    group: ec2-user

- name: Create .env for Vite
  copy:
    dest: /opt/task-manager/frontend/.env
    content: |
      VITE_API_URL="{{ VITE_API_URL }}"
    owner: ec2-user
    group: ec2-user
    mode: "0600"

- name: Install frontend dependencies
  become: yes
  npm:
    path: /opt/task-manager/frontend
    ci: yes

- name: Build frontend
  become: yes
  command: npm run build
  args:
    chdir: /opt/task-manager/frontend

- name: Fix build permissions
  become: yes
  file:
    path: /opt/task-manager/frontend/dist
    owner: ec2-user
    group: ec2-user
    recurse: yes

- debug:
    msg: "âœ… Frontend built successfully"
