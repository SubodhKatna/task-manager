- name: Check Node version again
  command: node -v
  register: node_v

- debug:
    msg: "Node version on system: {{ node_v.stdout }}"

- name: Install frontend dependencies (npm ci)
  become: yes
  npm:
    path: /opt/task-manager/frontend
    ci: yes

- name: Build frontend using Vite
  become: yes
  command: npm run build
  args:
    chdir: /opt/task-manager/frontend
  register: build_output
  changed_when: "'built in' in build_output.stdout"

- name: Fix build folder permissions
  become: yes
  file:
    path: /opt/task-manager/frontend/dist
    owner: ec2-user
    group: ec2-user
    recurse: yes

- name: Show build output directory
  debug:
    msg: "Frontend build complete! Files are in: /opt/task-manager/frontend/dist"
